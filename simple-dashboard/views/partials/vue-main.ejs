<script type="text/javascript">

// Initialize Google charts
google.charts.load('current');

//--------- BEGIN SELECT -------------------
let main = new Vue({
  el: '#sidebar-form',
  data: {
    selected: 'example.com',
    options: ['example.com'],
    results: {},
    sitename: ''
  },
  created () {
    let site = {}
    fetch('/results').then(resp => resp.json()).then(json => {
      let arr = []
      for (var i = 0; i < json.length; i++) {
        arr.push(json[i])
      }
      this.options = arr
      this.selected = arr[0]
    })
  },
  computed: {

  },
  methods: {
    updateModels: function() {
      // panelOverview.$data.pages =
      this.sitemapDb(this.selected).then(function(){
        console.log(this.results);
      });
    },
    sitemapDb: async function(id) {
      if (this.options.includes(id)) {
        fetch('/results/' + id).then(resp => resp.json()).then(json => {
          console.log(json);
          this.results = json
          panelOverview.pages = json.metadata.ogSiteName
        }).catch(err => console.log(err))
      } else {
        return null
      }
    },
    drawChart: function(data, options, id, chartType = 'ColumnChart') {
      let wrapper = new google.visualization.ChartWrapper({
          chartType: chartType,
          dataTable: data,
          options: options,
          containerId: 'vis_div'
        });
        wrapper.draw();
      }
    }
  }
});
//------------ END SELECT ----------------

let panelOverview = new Vue({
  el: "#panel-overview",
  data: {
    pages: "butt",
  },
  methods: {

  },
  computed: {
    sitemapOptions: function() {
      let obj = {}
      Object.keys(sitemap).forEach((el, index) => {
        obj[index] = {
          name: el
        }
      })
      return obj
    },
    sitemapNodeUrls: function() {
      if (!this.sitemapValue) {
        return [{ type: 'empty', url: 'empty' }]
      }
      let nodeTypes = sitemap[this.sitemapValue].nodeTypes
      let arr = []
      Object.keys(nodeTypes).forEach(function(el, index) {
        nodeTypes[el].urls.forEach(function(e, i) {
          arr.push({ type: el, url: e })
        })
      })

      return arr
    },
    sitemapMeta: function() {
      if (this.sitemapValue) {
        return sitemap[this.sitemapValue].metadata.title
      } else {
        return 'Drupal Content'
      }
    }
  },
  mounted() {
    if (this.sitemapValue) {
      this.createChart('nodeChart', this.sitemapNodes)
      this.createChart('formChart', this.sitemapForms)
      this.createChart('statusChart', this.sitemapStatus)
    }
  },
  metaInfo: {
    title: 'Drupal Content Audit'
  }
});


// Global name as `VirtualScrollList`
Vue.component('virtual-list', VirtualScrollList);



</script>
